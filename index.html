<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>成績輸入</title>
    <!-- 引入 Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
</head>
<body>
    <h1>成績輸入系統</h1>
    <label for="score">請輸入成績:</label>
    <input type="number" id="score" placeholder="輸入成績" />
    <button id="submitBtn">送出</button>

    <script>
        // Firebase 設定，請替換為你自己的 Firebase 配置
        const firebaseConfig = {
            apiKey: "AIzaSyDC3aVYPv57JyMHLfcV-OXb5ilsJJnsvlM",
            authDomain: "project-2082277388872876828.firebaseapp.com",
            databaseURL: "https://project-2082277388872876828-default-rtdb.firebaseio.com",
            projectId: "project-2082277388872876828",
            storageBucket: "project-2082277388872876828.firebasestorage.app",
            messagingSenderId: "557947332806",
            appId: "1:557947332806:web:8704cd145a87b4dcb64fc7"
        };

        // 初始化 Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // 取得按鈕和輸入框
        const submitBtn = document.getElementById('submitBtn');
        const scoreInput = document.getElementById('score');
        const scoreList = document.getElementById('scoreList');
        

        // 當按下送出按鈕時
        submitBtn.addEventListener('click', function() {
            const score = scoreInput.value;

            // 檢查成績是否為有效數字
            if (score && !isNaN(score)) {
                // 儲存到 Firebase Realtime Database
                const newScoreRef = database.ref('scores').push();
                newScoreRef.set({
                    score: score,
                    timestamp: new Date().toISOString()
                }).then(() => {
                    alert('成績已成功儲存！');
                    scoreInput.value = ''; // 清空輸入欄位
                }).catch((error) => {
                    alert('儲存失敗：' + error.message);
                });
            } else {
                alert('請輸入有效的成績');
            }
        });

         // 監聽 Firebase 中的成績資料變動，並更新頁面
         const scoresRef = database.ref('scores');

        // 使用 onValue 監聽數據變動
        onValue(scoresRef, (snapshot) => {
            // 清空現有的列表
            scoreList.innerHTML = '';

            // 遍歷所有成績並顯示在頁面上
            snapshot.forEach((childSnapshot) => {
                const scoreData = childSnapshot.val();
                const scoreItem = document.createElement('li');
                scoreItem.textContent = `成績: ${scoreData.score}, 時間: ${scoreData.timestamp}`;
                scoreList.appendChild(scoreItem);
            });
        });
    </script>
</body>
</html>
